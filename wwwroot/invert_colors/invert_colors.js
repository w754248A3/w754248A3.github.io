(()=>{"use strict";const e=document.getElementById("video_1"),t=document.getElementById("video_2"),n=document.getElementById("startRecording");function o(e,t,n){if(null===t)throw new Error("2d 绘制上下文是NULL");t.drawImage(n,0,0);var a=t.getImageData(0,0,e.width,e.height);!function(e){for(var t=0;t<e.length;t+=4)e[t]=255^e[t],e[t+1]=255^e[t+1],e[t+2]=255^e[t+2]}(a.data),t.putImageData(a,0,0),window.requestAnimationFrame((()=>o(e,t,n)))}n.addEventListener("click",(()=>{n.disabled=!0,navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}).then((n=>{e.srcObject=n,e.controls=!0,e.muted=!0,e.autoplay=!0,e.addEventListener("loadedmetadata",(function(){console.log(e.videoWidth,e.videoHeight);const n=function(e,t){const n=document.createElement("canvas");n.width=e,n.height=t;const o=n.getContext("2d");if(null===o)throw new Error("没有2D上下文");return{canvas:n,content2d:o}}(e.videoWidth,e.videoHeight);t.srcObject=n.canvas.captureStream(30),t.controls=!0,t.muted=!0,t.autoplay=!0,window.requestAnimationFrame((()=>o(n.canvas,n.content2d,e)))}))})).catch((e=>{console.error("获取屏幕流失败",e)}))}))})();