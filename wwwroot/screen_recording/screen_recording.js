(()=>{"use strict";const e=document.getElementById("videoPlayer"),t=document.getElementById("startRecording"),d=document.getElementById("stopRecording"),o=document.getElementById("canvas"),a=o.getContext("2d");let n,i;function c(e){if(null===a)throw new Error("2d 绘制上下文是NULL");a.drawImage(e,0,0);var t=a.getImageData(0,0,o.width,o.height);!function(e){for(var t=0;t<e.length;t+=4)e[t]=255^e[t],e[t+1]=255^e[t+1],e[t+2]=255^e[t+2]}(t.data),a.putImageData(t,0,0),setTimeout((function(){c(e)}),10)}t.addEventListener("click",(()=>{t.disabled=!0,d.disabled=!1,i=[],navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}).then((t=>{e.srcObject=t,e.controls=!1,e.muted=!0,e.autoplay=!0,setTimeout((()=>{return t=e,o.width=t.videoWidth,o.height=t.videoHeight,console.log(o.width,o.height),void setTimeout((()=>c(t)),1e3);var t}),1e3),n=new MediaRecorder(t),n.ondataavailable=e=>{e.data&&e.data.size},n.onstop=function(){t.getTracks().forEach((e=>e.stop()));const d=new Blob(i,{type:"video/webm"}),o=URL.createObjectURL(d),a=document.createElement("a");a.href=o,a.download="recording.webm",document.body.appendChild(a),document.body.removeChild(a),e.controls=!0,e.muted=!1,e.srcObject=null,e.src=o,e.play()},n.start()})).catch((e=>{console.error("获取屏幕流失败",e)}))})),d.addEventListener("click",(()=>{d.disabled=!0,t.disabled=!1,n.stop()}))})();