(()=>{"use strict";const e=document.getElementById("processBtn"),t=document.getElementById("status");"showOpenFilePicker"in window||(t.innerHTML='<span class="error">错误：您的浏览器不支持 File System Access API。<br>请使用最新版的 Chrome、Edge 或 Opera 浏览器。</span>',e.disabled=!0),e.addEventListener("click",async()=>{t.innerHTML="",e.disabled=!0;try{const[e]=await window.showOpenFilePicker({types:[{description:"All Files",accept:{"*/*":[]}}],multiple:!1}),n=await e.getFile();t.textContent=`已选择文件: ${n.name} (${function(e){if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB","TB"][t]}(n.size)})\n等待保存位置...`;const s=await window.showSaveFilePicker({suggestedName:n.name+".obfuscated",types:[{description:"Obfuscated File",accept:{"*/*":[]}}]});t.textContent+="\n正在处理中 (流式模式)...";const a=await s.createWritable(),r=n.stream(),i=new TransformStream({transform(e,t){for(let t=0;t<e.length;t++)e[t]=~e[t];t.enqueue(e)}});await r.pipeThrough(i).pipeTo(a),t.innerHTML+='\n<span class="success">成功！文件已保存。</span>'}catch(e){"AbortError"===e.name?t.textContent="用户取消了操作。":(console.error(e),t.innerHTML+=`\n<span class="error">发生错误: ${e.message}</span>`)}finally{e.disabled=!1}})})();